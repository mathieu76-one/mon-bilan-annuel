<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sadhana - Ã‰cologie Consciente</title>
    <style>
        :root { --primary: #1a2a6c; --secondary: #b21f1f; --accent: #27ae60; --bg: #f4f7f6; }
        body { font-family: 'Segoe UI', sans-serif; max-width: 850px; margin: 0 auto; padding: 20px; background: var(--bg); color: #333; }
        .card { background: white; padding: 25px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; }
        h2 { color: var(--secondary); border-left: 5px solid #fdbb2d; padding-left: 15px; margin-top: 0; }
        
        .grid-config { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .box { background: #f9f9f9; padding: 15px; border-radius: 10px; border: 1px solid #eee; }
        label { font-weight: bold; display: block; margin-bottom: 8px; color: var(--primary); }
        
        select, input, button { width: 100%; padding: 10px; margin-bottom: 8px; border-radius: 5px; border: 1px solid #ccc; box-sizing: border-box; font-family: inherit; }
        .btn-add { background: var(--accent); color: white; border: none; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-add:hover { opacity: 0.9; }

        .time-title { font-weight: bold; color: #7f8c8d; text-transform: uppercase; font-size: 0.8em; margin: 25px 0 10px; border-bottom: 2px solid #eee; padding-bottom: 5px; }
        .item { display: flex; align-items: center; background: white; padding: 12px; border-radius: 8px; border: 1px solid #eee; margin-bottom: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .item.done { background: #e8f5e9; border-color: var(--accent); }
        .item span { flex: 1; margin-left: 12px; font-weight: 500; }
        .item input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: var(--accent); }
        .btn-del { width: auto; background: none; border: none; color: #e74c3c; cursor: pointer; font-weight: bold; font-size: 1.2em; padding: 0 10px; margin: 0; }

        .log { background: #2c3e50; color: white; padding: 25px; border-radius: 15px; margin-top: 40px; }
        .log h3 { margin-top: 0; border-bottom: 1px solid #3e5871; padding-bottom: 10px; }
        .log-date { color: #f1c40f; font-weight: bold; display: block; margin-top: 15px; font-size: 0.9em; }
        .tag { background: var(--accent); color: white; padding: 3px 10px; border-radius: 4px; font-size: 0.8em; margin-right: 6px; display: inline-block; margin-top: 6px; }
    </style>
</head>
<body>

    <div class="card">
        <h2>Je choisis ma sadhana</h2>
        <p style="font-style: italic; color: #666; margin-top: -10px;">Pratiques tÃªte, cÅ“ur, corps pour m'aligner.</p>
        
        <div class="grid-config" id="config-area">
            </div>

        <div id="display-area" style="margin-top: 30px; border-top: 1px solid #eee; padding-top: 10px;">
            <h3 id="date-now" style="text-align:center; color: var(--primary); text-transform: capitalize;"></h3>
            <div id="list-matin"></div>
            <div id="list-jour"></div>
            <div id="list-soir"></div>
        </div>
    </div>

    <div class="log">
        <h3>ðŸ“œ Historique des pratiques</h3>
        <div id="log-content"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const today = new Date().toISOString().split('T')[0];
            const periods = [
                { id: 'matin', label: 'â˜€ï¸ MATIN' },
                { id: 'jour', label: 'ðŸŒ¤ï¸ JOURNÃ‰E' },
                { id: 'soir', label: 'ðŸŒ™ SOIR' }
            ];
            
            const activities = [
                "MÃ©ditation", 
                "Respiration consciente", 
                "Mouvements en conscience", 
                "Se relier Ã  ce qui est plus grand", 
                "ActivitÃ© physique", 
                "Journal spirituel", 
                "Soin Ã©nergÃ©tique"
            ];

            // 1. GÃ©nÃ©ration des menus dÃ©roulants identiques
            const configArea = document.getElementById('config-area');
            periods.forEach(p => {
                let options = activities.map(a => `<option value="${a}">${a}</option>`).join('');
                configArea.innerHTML += `
                    <div class="box">
                        <label>${p.label}</label>
                        <select id="s-${p.id}"><option value="">-- Liste --</option>${options}</select>
                        <input type="text" id="i-${p.id}" placeholder="Ou autre pratique...">
                        <button class="btn-add" onclick="add('${p.id}')">Ajouter</button>
                    </div>`;
            });

            document.getElementById('date-now').innerText = new Date().toLocaleDateString('fr-FR', {weekday:'long', day:'numeric', month:'long'});

            // 2. Fonctions Globales
            window.add = function(p) {
                const sel = document.getElementById('s-'+p);
                const inp = document.getElementById('i-'+p);
                const val = sel.value || inp.value;
                if(val) {
                    let struct = JSON.parse(localStorage.getItem('sad_v10')) || {matin:[], jour:[], soir:[]};
                    struct[p].push({id: 'id' + Date.now(), name: val});
                    localStorage.setItem('sad_v10', JSON.stringify(struct));
                    sel.value = ''; inp.value = '';
                    render();
                }
            };

            window.remove = function(p, id) {
                let struct = JSON.parse(localStorage.getItem('sad_v10'));
                struct[p] = struct[p].filter(x => x.id !== id);
                localStorage.setItem('sad_v10', JSON.stringify(struct));
                render();
            };

            window.toggle = function(id) {
                let chks = JSON.parse(localStorage.getItem('chks_'+today)) || {};
                chks[id] = !chks[id];
                localStorage.setItem('chks_'+today, JSON.stringify(chks));
                saveToHistory();
                render();
            };

            function saveToHistory() {
                let struct = JSON.parse(localStorage.getItem('sad_v10')) || {matin:[], jour:[], soir:[]};
                let chks = JSON.parse(localStorage.getItem('chks_'+today)) || {};
                let hist = JSON.parse(localStorage.getItem('hist_v10')) || {};
                let done = [];
                [...struct.matin, ...struct.jour, ...struct.soir].forEach(i => { 
                    if(chks[i.id]) done.push(i.name); 
                });
                if(done.length) hist[today] = done; else delete hist[today];
                localStorage.setItem('hist_v10', JSON.stringify(hist));
            }

            function render() {
                let struct = JSON.parse(localStorage.getItem('sad_v10')) || {matin:[], jour:[], soir:[]};
                let chks = JSON.parse(localStorage.getItem('chks_'+today)) || {};
                
                periods.forEach(p => {
                    const cont = document.getElementById('list-'+p.id);
                    cont.innerHTML = `<div class="time-title">${p.label}</div>`;
                    struct[p.id].forEach(item => {
                        const d = document.createElement('div');
                        d.className = 'item' + (chks[item.id] ? ' done' : '');
                        d.innerHTML = `
                            <input type="checkbox" ${chks[item.id]?'checked':''} onchange="toggle('${item.id}')">
                            <span>${item.name}</span>
                            <button class="btn-del" onclick="remove('${p.id}','${item.id}')">âœ•</button>
                        `;
                        cont.appendChild(d);
                    });
                });
                renderLog();
            }

            function renderLog() {
                let hist = JSON.parse(localStorage.getItem('hist_v10')) || {};
                const cont = document.getElementById('log-content');
                cont.innerHTML = '';
                Object.keys(hist).sort().reverse().forEach(d => {
                    const dateObj = new Date(d);
                    const formatted = dateObj.toLocaleDateString('fr-FR', {day:'numeric', month:'short'});
                    cont.innerHTML += `<span class="log-date">${formatted} :</span>` + 
                        hist[d].map(t => `<span class="tag">${t}</span>`).join('');
                });
            }

            render();
        });
    </script>
</body>
</html>
